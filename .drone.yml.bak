kind: pipeline
type: docker
name: runner-test

steps:
  - name: Build
    image: golang
    volumes:
      - name: build-volume
        path: /home/ubuntu
    commands: 
      - echo "Starting Build"
      - mkdir -p /home/ubuntu/Go
      - cp main.go /home/ubuntu/Go
      - cd /home/ubuntu/Go
      - go mod init app
      - go build -o app

  - name: Deploy
    image: golang
    resources:
      limits:
        memory: 512MiB
        cpu: 0.5
    volumes:
      - name: build-volume
        path: /home/ubuntu/Go
    commands:
      - echo "Deploying"
      - cd /home/ubuntu/Go
      - ./app
      - echo "Deployed"

  - name: Goofy ahh
    image: alpine
    commands:
      - echo "Hello, World!"
      - echo "( ͡° ͜ʖ ͡°)"
      - echo "Ghost Commit"

volumes: 
  - name: build-volume
    host:
      path: /home/ubuntu
